# Anime1 Desktop Electron Forge - TODO 列表

## 已完成的功能 ✅

### 基础功能
- [x] 番剧列表展示（首页）
- [x] 番剧详情页
- [x] 视频播放（HLS/MP4）
- [x] 收藏功能（添加/移除/列表）
- [x] 播放历史
- [x] 搜索功能
- [x] Bangumi 封面和评分集成
- [x] 主题切换（深色/浅色）
- [x] 键盘快捷键

### 设置功能
- [x] 检查更新
- [x] 清除缓存
- [x] 关于信息
- [x] 日志查看（外部打开）

### 自动下载 ✅ 已完善
- [x] 基础配置（路径、间隔、并发）
- [x] 筛选条件（年份、季度、集数、正则）
- [x] 筛选预览
- [x] 下载历史
- [x] 服务状态管理
- [x] **VideoDownloader 完整实现** ✅ 新增
  - [x] 异步下载
  - [x] 进度追踪（字节、百分比、速度）
  - [x] 并发下载限制
  - [x] 下载队列管理
  - [x] 断点续传
  - [x] 实时事件到前端

### 系统功能
- [x] 托盘图标（macOS）
- [x] 应用更新（electron-updater）
- [x] 数据库（electron-store）

---

## 待完成/待确认的功能 ⚠️

### 1. 视频代理功能 🔴 重要
**Python 项目有完整视频代理，Electron 项目需要补充**

| 功能 | Python 状态 | Electron 状态 | 优先级 |
|------|------------|---------------|--------|
| Episode API 代理 | ✅ | ⚠️ 部分实现 | 🟡 中 |
| 视频 URL 获取 | ✅ | ✅ 已实现 | ✅ |
| HLS 播放列表代理 | ✅ | ❌ 未实现 | 🟡 中 |
| 视频流代理 | ✅ | ❌ 未实现 | 🟢 低 |
| Player 页面代理 | ✅ | ❌ 未实现 | 🟢 低 |

---

### 性能追踪系统 ✅ 已完成
**完整的分布式追踪系统，对标 Python 项目**

| 功能 | Python 状态 | Electron 状态 | 优先级 |
|------|------------|---------------|--------|
| 性能数据记录 | ✅ | ✅ 已实现 | ✅ |
| Trace 链追踪 | ✅ | ✅ 已实现 | ✅ |
| 性能统计 | ✅ | ✅ 已实现 | ✅ |
| 批量性能记录 | ✅ | ✅ 已实现 | ✅ |

**实现特性：**
- Trace/Span 树形结构
- 性能评分（good/needs-improvement/poor）
- 百分位数计算（P50/P90/P99）
- 按操作名称统计
- 数据持久化到 electron-store

---

### 3. 缓存管理 🟡 中
**Python 项目有更完善的缓存系统**

| 功能 | Python 状态 | Electron 状态 | 优先级 |
|------|------------|---------------|--------|
| 封面缓存 | ✅ 持久化 | ✅ 已实现 | ✅ |
| 播放列表缓存 | ✅ | ⚠️ 内存缓存 | 🟡 中 |
| 缓存状态查询 | ✅ | ⚠️ 部分 | 🟢 低 |
| 强制刷新缓存 | ✅ | ❌ 未实现 | 🟢 低 |

---

### 4. 日志系统 🟡 中
**需要完善日志查看功能**

| 功能 | Python 状态 | Electron 状态 | 优先级 |
|------|------------|---------------|--------|
| 日志记录 | ✅ | ✅ electron-log | ✅ |
| 日志查看 API | ✅ | ❌ 未实现 | 🟡 中 |
| 日志清除 | ✅ | ⚠️ 外部打开 | 🟢 低 |
| 日志级别设置 | ✅ | ❌ 未实现 | 🟢 低 |

---

### 5. 测试覆盖 🔴 重要

| 类型 | Python 状态 | Electron 状态 | 优先级 |
|------|------------|---------------|--------|
| 单元测试 | ✅ pytest | ❌ 未实现 | 🔴 高 |
| 集成测试 | ✅ | ⚠️ Playwright E2E | 🟡 中 |
| API 测试 | ✅ | ❌ | 🟡 中 |
| UI 测试 | ✅ | ⚠️ 部分 | 🟢 低 |

---

## 开发优先级建议

### 阶段 1：核心功能完善（P0 - 必须）✅ 基本完成
1. ✅ 视频播放基础功能
2. ✅ 自动下载功能（含 VideoDownloader）
3. ⚠️ 视频代理稳定性优化

### 阶段 2：体验优化（P1 - 重要）
1. 性能追踪系统
2. 日志查看功能
3. 错误处理完善

### 阶段 3：高级功能（P2 - 可选）
1. 命令行工具
2. 数据迁移
3. 更多平台支持

---

## 最近更新

### 2026-02-13
- ✅ 实现完整的 VideoDownloader 服务
- ✅ 添加下载进度追踪和实时事件
- ✅ 修复字段名映射问题（camelCase ↔ snake_case）
- ✅ 修复 null config 错误

---

## 技术债务

1. **字段名不一致**：已大部分修复
2. **错误处理**：需要统一的错误处理中间件
3. **类型定义**：缺少 TypeScript 类型定义
