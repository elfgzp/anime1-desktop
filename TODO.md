# Anime1 Desktop Electron Forge - TODO 列表

## 已完成的功能 ✅

### 基础功能
- [x] 番剧列表展示（首页）
- [x] 番剧详情页
- [x] 视频播放（HLS/MP4）
- [x] 收藏功能（添加/移除/列表）
- [x] 播放历史
- [x] 搜索功能
- [x] Bangumi 封面和评分集成
- [x] 主题切换（深色/浅色）
- [x] 键盘快捷键

### 设置功能
- [x] 检查更新
- [x] 清除缓存
- [x] 关于信息
- [x] 日志查看（外部打开）

### 自动下载
- [x] 基础配置（路径、间隔、并发）
- [x] 筛选条件（年份、季度、集数、正则）
- [x] 筛选预览
- [x] 下载历史
- [x] 服务状态管理

### 系统功能
- [x] 托盘图标（macOS）
- [x] 应用更新（electron-updater）
- [x] 数据库（electron-store）

---

## 待完成/待确认的功能 ⚠️

### 1. 视频代理功能 🔴 重要
**Python 项目有完整视频代理，Electron 项目需要补充**

| 功能 | Python 状态 | Electron 状态 | 优先级 |
|------|------------|---------------|--------|
| Episode API 代理 | ✅ | ❌ 未实现 | 🔴 高 |
| 视频 URL 获取 | ✅ | ❌ 部分实现 | 🔴 高 |
| HLS 播放列表代理 | ✅ | ❌ 未实现 | 🟡 中 |
| 视频流代理 | ✅ | ❌ 未实现 | 🟡 中 |
| Player 页面代理 | ✅ | ❌ 未实现 | 🟢 低 |

**实现方案：**
- 需要在 main.js 中添加 Express 服务器作为代理
- 或者使用 Electron 的 protocol.registerFileProtocol

---

### 2. 性能追踪系统 🟡 中
**Python 项目有完整性能追踪，Electron 项目有页面但缺少后端**

| 功能 | Python 状态 | Electron 状态 | 优先级 |
|------|------------|---------------|--------|
| 性能数据记录 | ✅ | ❌ 未实现 | 🟡 中 |
| Trace 链追踪 | ✅ | ❌ 未实现 | 🟡 中 |
| 性能统计 | ✅ | ❌ 未实现 | 🟢 低 |
| 批量性能记录 | ✅ | ❌ 未实现 | 🟢 低 |

**当前状态：** Performance.vue 页面存在但后端 API 未实现

---

### 3. 下载管理器 🔴 重要
**Python 项目有完整下载器，Electron 项目只有基础框架**

| 功能 | Python 状态 | Electron 状态 | 优先级 |
|------|------------|---------------|--------|
| 异步下载 | ✅ asyncio | ❌ 基础 axios | 🔴 高 |
| 下载进度追踪 | ✅ | ❌ 不完整 | 🔴 高 |
| 断点续传 | ✅ | ❌ 未实现 | 🟡 中 |
| 并发下载限制 | ✅ | ❌ 未实现 | 🟡 中 |
| 下载速度计算 | ✅ | ❌ 未实现 | 🟢 低 |
| 下载队列管理 | ✅ | ❌ 未实现 | 🟡 中 |

**需要实现：**
- videoDownloader.js 完整功能
- 下载队列管理
- 进度事件通过 IPC 发送到前端

---

### 4. 缓存管理 🔴 重要
**Python 项目有更完善的缓存系统**

| 功能 | Python 状态 | Electron 状态 | 优先级 |
|------|------------|---------------|--------|
| 封面缓存 | ✅ 持久化 | ✅ 已实现 | ✅ |
| 播放列表缓存 | ✅ | ⚠️ 内存缓存 | 🟡 中 |
| 缓存状态查询 | ✅ | ⚠️ 部分 | 🟢 低 |
| 强制刷新缓存 | ✅ | ❌ 未实现 | 🟢 低 |

---

### 5. 命令行工具 🟢 低
**Python 项目有 CLI 工具，Electron 项目未实现**

| 功能 | Python 状态 | Electron 状态 | 优先级 |
|------|------------|---------------|--------|
| 自动下载 CLI | ✅ | ❌ | 🟢 低 |
| 更新检查 CLI | ✅ | ❌ | 🟢 低 |
| 状态查看 CLI | ✅ | ❌ | 🟢 低 |

**Electron 实现方案：** 使用 commander.js 添加 CLI 支持

---

### 6. 日志系统 🟡 中
**需要完善日志查看功能**

| 功能 | Python 状态 | Electron 状态 | 优先级 |
|------|------------|---------------|--------|
| 日志记录 | ✅ | ✅ electron-log | ✅ |
| 日志查看 API | ✅ | ❌ 未实现 | 🟡 中 |
| 日志清除 | ✅ | ⚠️ 外部打开 | 🟢 低 |
| 日志级别设置 | ✅ | ❌ 未实现 | 🟢 低 |

---

### 7. 数据迁移 🟢 低
**Python 项目有数据库迁移功能**

| 功能 | Python 状态 | Electron 状态 | 优先级 |
|------|------------|---------------|--------|
| 数据库迁移 | ✅ | ❌ | 🟢 低 |
| 版本升级处理 | ✅ | ❌ | 🟢 低 |

---

### 8. 平台特定功能 🟡 中

| 功能 | Python 状态 | Electron 状态 | 优先级 |
|------|------------|---------------|--------|
| macOS 更新器 | ✅ | ⚠️ 通用 updater | 🟡 中 |
| Windows 更新器 | ✅ | ⚠️ 通用 updater | 🟡 中 |
| Linux 支持 | ✅ | ❌ 未测试 | 🟢 低 |
| 应用签名 | ✅ | ❌ 需要配置 | 🟡 中 |

---

### 9. 测试覆盖 🔴 重要

| 类型 | Python 状态 | Electron 状态 | 优先级 |
|------|------------|---------------|--------|
| 单元测试 | ✅ pytest | ❌ 未实现 | 🔴 高 |
| 集成测试 | ✅ | ⚠️ Playwright E2E | 🟡 中 |
| API 测试 | ✅ | ❌ | 🟡 中 |
| UI 测试 | ✅ | ⚠️ 部分 | 🟢 低 |

---

### 10. 错误处理和边界情况 🟡 中

| 功能 | Python 状态 | Electron 状态 | 优先级 |
|------|------------|---------------|--------|
| 网络错误重试 | ✅ | ⚠️ 部分 | 🟡 中 |
| 超时处理 | ✅ | ⚠️ 部分 | 🟡 中 |
| 错误恢复 | ✅ | ❌ | 🟡 中 |
| 限流处理 | ✅ | ❌ | 🟢 低 |

---

## 开发优先级建议

### 阶段 1：核心功能完善（P0 - 必须）
1. ✅ 视频播放基础功能（已完成）
2. ⚠️ 视频代理稳定性优化
3. ⚠️ 下载功能完善

### 阶段 2：体验优化（P1 - 重要）
1. 性能追踪系统
2. 日志查看功能
3. 错误处理完善

### 阶段 3：高级功能（P2 - 可选）
1. 命令行工具
2. 数据迁移
3. 更多平台支持

---

## 技术债务

1. **字段名不一致**：部分前后端字段名需要统一（已部分修复）
2. **错误处理**：需要统一的错误处理中间件
3. **类型定义**：缺少 TypeScript 类型定义
4. **代码组织**：部分功能代码需要模块化重构
